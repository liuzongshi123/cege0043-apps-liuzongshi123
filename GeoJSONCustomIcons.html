<html>
<head>
 <!-- the following links add the CSS and Javascript required for the Leaflet Map -->
 <link rel="stylesheet" href="https://unpkg.com/leaflet@1.1.0/dist/leaflet.css"
   integrity="sha512-wcw6ts8Anuw10Mzh9Ytw4pylW8+NAD4ch3lqm9lzAsTxg0GFeJgoAtxuCLREZSC5lUXdVyo/7yfsqFjQ4S+aKw=="
   crossorigin=""/>

 <!-- the following links incorporate the CSS required for custom icon creation -->
 <link rel="stylesheet" href="css/ionicons.min.css">
 <link rel="stylesheet" href="css/leaflet.awesome-markers.css">


<script src="https://unpkg.com/leaflet@1.1.0/dist/leaflet.js"
   integrity="sha512-mNqn2Wg7tSToJhvHcqfzLMU6J4mkOImSPTxVZAdo+lcPlk+GhZmYgACEe0x35K7YzW1zJ7XyJV/TT1MrdXvMcA=="
   crossorigin=""></script>


<script src="js/leaflet.awesome-markers.js"></script>

<script 
	src="https://code.jquery.com/jquery-3.4.1.min.js"
	integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
	crossorigin="anonymous"></script>

  <!-- the following CSS is used to set the size of the Map -->
  <style type="text/css"> 
#mapid { height: 180px; }


</style>

</head>
<body>


<!-- the mapid div will hold the map -->
<div id="mapid" style="width: 600px; height: 400px;"></div>
<!-- the following script will load the map and set the default view and zoom, as well as loading the basemap tiles -->
<script>

	
	var mymap; // global variable to store the map

	// create a custom popup as a global variable
	var popup = L.popup();

	// create an event detector to wait for the user's click event and then use the popup to show them where they clicked
    // note that you don't need to do any complicated maths to convert screen coordinates to real world coordiantes - the Leaflet API does this for you
    
    function onMapClick(e) {
    	popup
    			.setLatLng(e.latlng)
    			.setContent("You clicked the map at "+e.latlng.toString())
    			.openOn(mymap);
    }

    var earthquakeLayer;

    function getEarthquakeData(){
    	var layerURL = "https://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/all_hour.geojson";
    	var testMarkerRed = L.AwesomeMarkers.icon({
    			icon: 'play',
    			markerColor: 'red'
    		});
    		var testMarkerPink = L.AwesomeMarkers.icon({
    			icon: 'play',
    			markerColor: 'pink'
    		});
    	$.ajax({url: layerURL, crossDomain: true, success: function(result){
    		console.log(result); // check that the data is correct
    		// load the geoJSON layer
			earthquakeLayer = L.geoJson(result,
			{
			// use point to layer to create the points
			pointToLayer: function (feature, latlng){
				// look at the GeoJSON file - specifically at the properties - to see the earthquake magnitude and use a different marker depending on this value
 				// also include a pop-up that shows the place value of the earthquakes
 				if (feature.properties.mag > 1.75) {
 					return L.marker(latlng,  
 						{icon:testMarkerRed}).bindPopup("<b>"+feature.properties.place +"</b>");
 				}
 				else {
 				// magnitude is 1.75 or less
 				return L.marker(latlng, 
 				{icon:testMarkerPink}).bindPopup("<b>"+feature.properties.place +"</b>");;
 					}
 				}, // end of point to layer
 			}).addTo(mymap);
			// change the map zoom so that all the data is shown
 			mymap.fitBounds(earthquakeLayer.getBounds());
 			} // end of the inner function
		}); // end of the ajax request
	} // end of the getEarthquakeData function


	function loadLeafletMap(){
	mymap = L.map('mapid').setView([51.505, -0.09], 13);

	// load the tiles
	L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
		maxZoom: 18,
		attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
			'<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
			'Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
		id: 'mapbox.streets'
	}).addTo(mymap);

	// now add the click event detector to the map
	mymap.on('click', onMapClick);

	// now call the code to add the markers
	
	addBasicMarkers();

	} //end code to add the leaflet map

	function addBasicMarkers() {

	var testMarkerPink = L.AwesomeMarkers.icon({
		icon:'play',
		markerColor:'pink'
	});

	// add a circle
	L.circle([51.508, -0.11], 500, {
			   color:'red',
			   fillColor:'#f03',
			   fillOpacity:0.5
	}).addTo(mymap).bindPopup("I am a circle.");

	// create a geoJSON feature -
	var geojsonFeature = {
		"type":"Feature",
		"properties":{
			"name":"London",
			"popupContent":"This is where UCL is based"
		},
		"geometry":{
			"type":"Point",
			"coordinates":[-0.136470, 51.523079]
		}
	};
	// and add it to the map
	L.geoJSON(geojsonFeature, {
		pointToLayer: function (feature, latlng) {
			return L.marker(latlng,{icon:testMarkerPink});
		}
	}).addTo(mymap).bindPopup("<b>"+geojsonFeature.properties.name+
" "+geojsonFeature.properties.popupContent+"<b>");


	} // end code to add the basic markers




document.addEventListener('DOMContentLoaded', function(){
	loadMap();
}, false);

function loadMap(){
	loadLeafletMap();
	getEarthquakeData();
}
</script>



</body>
</html>

